<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<script src="js/jquery-1.4.2.min.js" type="text/javascript"></script> 
	<script src="js/jquery-ui-1.8.custom.min.js" type="text/javascript"></script>
	<script src="js/jquery.dataTables.min.js" type="text/javascript"></script>
	
	<link rel="stylesheet" href="css/smoothness/jquery-ui-1.8.custom.css" type="text/css" media="all" /> 
	<link href="css/datatable.css" type="text/css" media="screen, print" rel="stylesheet" />
	<link href="css/zp-compressed.css" type="text/css" media="screen, print" rel="stylesheet" />
	<link href="css/zp-print.css" type="text/css" media="print" rel="stylesheet" />

	<!--[if IE]>
	<link href="css/zp-ie.css" type="text/css" media="screen" rel="stylesheet" />
	<![endif]-->
	<title>RIAK Admin UI</title>
	<script type="text/javascript">
		var keysTable;
		$(function() {
			//$("#tabs").tabs();
			keysTable = $('#keysTable').dataTable({
				"bJQueryUI": true,
				"sPaginationType": "full_numbers",
				"bAutoWidth": false,
				"aoColumns" : [
				    { sWidth: '1%', bSortable: false, sClass: 'center' },
					{ sWidth: '99%' }
				]
			});
			$('#check_all').click( function() {
				var checked = this.checked;
				$('input', keysTable.fnGetNodes()).each(function() {
					$(this).attr('checked',checked);
					var tr = $(this).parent().parent();
					if (checked) {
						$(tr).addClass("row_selected");
					} else {
						$(tr).removeClass("row_selected");
					}
				});
			});
			
			$("#retrieve_btn").click(function(){
				keysTable.fnClearTable();
				$('#msg').removeClass("error");
				$('#msg').removeClass("notice");
				$('#msg').text('');
				var url = $('#riak_server').val() + "/" + $('#bucket').val() + "?props=false";
				$.ajax({url: url, success: function(data, textStatus, xhr){
					if (data.keys == undefined) {
						$('#msg').addClass("error");
						$('#msg').text('Failed. Data has no keys');
						return;
					} else {
						$('#msg').addClass("notice");
						$('#msg').text('Success');						
					}

					$.each(data.keys, function(id){
						keysTable.fnAddData([
							"<input type='checkbox' />",
							data.keys[id]
							]);
					});
					
					$('input', keysTable.fnGetNodes()).click(function(){
						var tr = $(this).parent().parent();
						//var pos = keysTable.fnGetPosition(tr);
						if (this.checked) {
							$(tr).addClass("row_selected");
						} else {
							$(tr).removeClass("row_selected");
						}
					});
				
				}});
			});
		});
	</script>
</head>

<body>
<div class="zp-wrapper">
	<h1>RIAK Admin UI</h1>
	<hr class="clear"/>
	<div id="msg" class="notification"></div>
	<div class="form-item">
		<label for="riak_server">Riak Context</label>
		<input tabindex="1" id="riak_server" type="text" name="riak_server" value="/riak"/>	
	</div>
	<div class="form-item">
		<label for="bucket">Bucket</label>
		<input tabindex="2" id="bucket" name="bucket" type="text" value="article">
	</div>
	<button id="retrieve_btn">Retrieve</button>
	<div class="clear"></div>
	<table cellpadding="0" cellspacing="0" border="0" class="display" id="keysTable"> 
		<thead> 
			<tr> 
				<th style="width:20px"><input type="checkbox" id="check_all" name="check_all"/></th> 
				<th>Keys</th> 
			</tr> 
		</thead>
		<tbody>
			
		</tbody>
	</table>
</div>
</body>
</html>
